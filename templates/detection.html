{% extends "layout.html" %}
{% block title %}细胞分裂检测{% endblock %}
{% block head %}
  {{ super() }}

  <script type="text/javascript" src="{{ url_for('static', filename='jquery/jquery.js') }}"></script>
  <script type="text/javascript"> var $SCRIPT_ROOT = {{ request.script_root|tojson|safe}}; </script>

  <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}">
  <script src="{{ url_for('static', filename='bootstrap/js/bootstrap.min.js') }}"></script>

  <script src="{{ url_for('static', filename='colorbox/jquery.colorbox.js') }}"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='colorbox/colorbox.css') }}" type="text/css" media="screen">

  <script type="text/javascript">
          function submitForm() {
              //alert('test submitForm');
              console.log("submit event");
              var fd = new FormData(document.getElementById("fileinfo"));
              fd.append("label", "WEBUPLOAD");
              console.log();
              $.ajax({
                url: "/upload_multifiles",
                type: "POST",
                data: fd,
                enctype: 'multipart/form-data',
                processData: false,  // tell jQuery not to process the data
                contentType: false   // tell jQuery not to set contentType
              }).done(function( data ) {
                  console.log("Flask Output:");
                  console.log( data );
                  console.log( data.originalImage.length );
                  console.log( data.originalImage[0] );
                  console.log( data.detectedImage[0] );
                  for(var i=0; i<data.originalImage.length; i++)
                  {
                    $('#original>ul').append('<li><a href={{ url_for('static', filename='images/1.png') }} title="{{ url_for('static', filename='images/1.png') }}" class="group4"><img src={{ url_for('static', filename=images/1.png') }} /></a></li>');
                    $('#originalImage').attr('src', data.originalImage);
                    $('#segmentedImage').attr('src', data.detectedImage);
                  }

                  if(typeof(data.msg)!="undefined")
                  {
                    alert(data.msg);
                  }
              });
              return false;
          }
      </script>
{% endblock %}
{% block body %}
<div class="container">
  <div class="jumbotron">
    <h1>细胞分裂检测</h1>
    <h2 style="float:right;"><a href="./">返回首页</a></h2>
    <p>基于深度神经网络的细胞分裂检测</p>
  </div>
  <div class="row">

    <div class="col-sm-4">
      <h1>选择文件</h1>
      <div id="uploader">
        <form action="" id="fileinfo" method=post enctype=multipart/form-data onsubmit="return submitForm();">
        <p><input type=file name=file></p>
        <p><input type=file name=file></p>
        <input id="send_upload_request" type=submit value=Upload>
        </form>
      </div>
    </div>

    <div class="col-sm-4">
      <h3>原图像</h3>
      <div id="original">
        <ul>
          <li><a href={{ url_for('static', filename='images/1.png') }} title="{{ url_for('static', filename='images/1.png') }}" class="group4"><img src={{ url_for('static', filename='images/1.png') }} /></a></li>
        </ul>
      </div>
    </div>

    <div class="col-sm-4">
      <h3>分裂检测结果</h3>
      <div id="segmented">
        <img id="segmentedImage" width="300" height="300"/>
      </div>
    </div>
  </div>
</div>
{% endblock %}
